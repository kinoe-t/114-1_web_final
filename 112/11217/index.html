<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒèŸ¹ Nonogram</title>
    <style>
        /* --- CSS æ¨£å¼ --- */
        :root {
            --bg-color: #000000;
            --main-white: #ffffff;
            --cell-size: 45px;
            /* è®“èƒèŸ¹è®Šé»ƒè‰²çš„æ¿¾é¡ */
            --yellow-filter: sepia(1) saturate(100) hue-rotate(40deg);
        }

        body {
            background-color: var(--bg-color);
            color: var(--main-white);
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            letter-spacing: 5px;
            color: #ffcc00;
        }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            gap: 20px;
        }

        .heart {
            color: #ff4d4d;
            font-size: 1.5rem;
        }

        /* éŠæˆ²ä¸»é«”æ’ç‰ˆ */
        .game-container {
            display: grid;
            grid-template-columns: auto auto;
            grid-template-rows: auto auto;
            background-color: var(--main-white);
            padding: 5px;
            border-radius: 8px;
        }

        /* æç¤ºæ•¸å­— */
        .clues-top {
            grid-column: 2;
            display: flex;
            background-color: var(--bg-color);
        }

        .clue-col {
            width: var(--cell-size);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            font-size: 14px;
            padding-bottom: 5px;
            border: 1px solid #333;
            box-sizing: border-box;
        }

        .clues-left {
            grid-row: 2;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
        }

        .clue-row {
            height: var(--cell-size);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            font-size: 14px;
            padding-right: 10px;
            border: 1px solid #333;
            box-sizing: border-box;
            min-width: 60px;
        }

        /* ç¶²æ ¼ */
        #grid {
            grid-row: 2;
            grid-column: 2;
            display: grid;
            grid-template-columns: repeat(7, var(--cell-size));
            grid-template-rows: repeat(7, var(--cell-size));
            background-color: #333;
            gap: 1px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 28px;
            position: relative;
        }

        /* é»ƒè‰²èƒèŸ¹ */
        .cell.crab::after {
            content: "ğŸ¦€";
            filter: var(--yellow-filter);
            animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* å‰å‰ */
        .cell.cross::after {
            content: "âŒ";
            font-size: 20px;
            opacity: 0.7;
        }

        /* éŒ¯èª¤é»æ“Š */
        .cell.error {
            background-color: #441111;
        }
        .cell.error::after {
            content: "âœ–";
            color: #ff0000;
        }

        @keyframes pop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* æ§åˆ¶æŒ‰éˆ• */
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }

        button {
            background-color: #ffcc00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover {
            transform: scale(1.05);
            background-color: #ffe066;
        }

        /* å½ˆçª—ç•«é¢ */
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
        }

        .big-crab {
            font-size: 150px;
            position: relative;
            filter: var(--yellow-filter);
        }

        .crown {
            font-size: 80px;
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%) rotate(-10deg);
            filter: none; /* çš‡å† ä¸è¦è®Šè‰²æ¿¾é¡ */
        }

        .overlay h2 {
            font-size: 2.5rem;
            margin: 20px 0;
        }

    </style>
</head>
<body>

    <h1>èƒèŸ¹ NONOGRAM</h1>

    <div class="status-bar">
        <div id="lives-container">ç”Ÿå‘½å€¼: <span class="heart">â¤ï¸â¤ï¸â¤ï¸</span></div>
    </div>

    <div class="game-container">
        <div style="background-color: var(--bg-color); border: 1px solid #333;"></div>
        <div id="col-clues" class="clues-top"></div>
        <div id="row-clues" class="clues-left"></div>
        <div id="grid"></div>
    </div>

    <div class="controls">
        <button onclick="newGame()">æ–°éŠæˆ²</button>
        <button onclick="restartLevel()">é‡æ–°é–‹å§‹</button>
    </div>

    <div id="overlay" class="overlay">
        <div id="crab-icon-container">
            <div class="big-crab">
                <div class="crown" id="crown-icon">ğŸ‘‘</div>
                ğŸ¦€
            </div>
        </div>
        <h2 id="overlay-title">ä½ è´äº†ï¼</h2>
        <button onclick="newGame()">å†ç©ä¸€å±€</button>
    </div>

    <script>
        /* --- JavaScript é‚è¼¯ --- */
        const SIZE = 7;
        let solution = [];
        let playerGrid = [];
        let lives = 3;
        let isGameOver = false;

        // è¨ˆç®—æç¤ºæ•¸å­—
        function getClues(line) {
            let clues = [];
            let count = 0;
            for (let val of line) {
                if (val === 1) {
                    count++;
                } else if (count > 0) {
                    clues.push(count);
                    count = 0;
                }
            }
            if (count > 0) clues.push(count);
            return clues.length > 0 ? clues : [0];
        }

        // ç”Ÿæˆéš¨æ©Ÿé¡Œç›®
        function generateSolution() {
            return Array.from({ length: SIZE }, () => 
                Array.from({ length: SIZE }, () => Math.random() > 0.4 ? 1 : 0)
            );
        }

        // åˆå§‹åŒ–/æ–°éŠæˆ²
        function newGame() {
            solution = generateSolution();
            restartLevel();
        }

        // é‡æ–°é–‹å§‹ï¼ˆä¿ç•™åŸé—œå¡ï¼‰
        function restartLevel() {
            lives = 3;
            isGameOver = false;
            playerGrid = Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
            document.getElementById('overlay').style.display = 'none';
            updateUI();
        }

        function updateUI() {
            const gridEl = document.getElementById('grid');
            const rowCluesEl = document.getElementById('row-clues');
            const colCluesEl = document.getElementById('col-clues');
            const livesEl = document.getElementById('lives-container');

            gridEl.innerHTML = '';
            rowCluesEl.innerHTML = '';
            colCluesEl.innerHTML = '';
            livesEl.innerHTML = `ç”Ÿå‘½å€¼: <span class="heart">${'â¤ï¸'.repeat(lives)}</span>`;

            // ç”Ÿæˆåˆ—æç¤º (Top)
            for (let c = 0; c < SIZE; c++) {
                const colData = [];
                for (let r = 0; r < SIZE; r++) colData.push(solution[r][c]);
                const clues = getClues(colData);
                const div = document.createElement('div');
                div.className = 'clue-col';
                div.innerHTML = clues.join('<br>');
                colCluesEl.appendChild(div);
            }

            // ç”Ÿæˆè¡Œæç¤º (Left)
            for (let r = 0; r < SIZE; r++) {
                const clues = getClues(solution[r]);
                const div = document.createElement('div');
                div.className = 'clue-row';
                div.innerText = clues.join(' ');
                rowCluesEl.appendChild(div);
            }

            // ç”Ÿæˆæ ¼å­
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    cell.addEventListener('mousedown', (e) => {
                        if (isGameOver) return;
                        if (e.button === 0) { // å·¦éµ
                            handleLeftClick(r, c, cell);
                        } else if (e.button === 2) { // å³éµ
                            handleRightClick(r, c, cell);
                        }
                    });

                    // ç¦ç”¨å³éµé¸å–®
                    cell.addEventListener('contextmenu', e => e.preventDefault());
                    gridEl.appendChild(cell);
                }
            }
        }

        function handleLeftClick(r, c, cell) {
            if (playerGrid[r][c] !== 0) return;

            if (solution[r][c] === 1) {
                playerGrid[r][c] = 1;
                cell.classList.add('crab');
                checkWin();
            } else {
                playerGrid[r][c] = -1; // æ¨™è¨˜éŒ¯èª¤
                cell.classList.add('error');
                lives--;
                document.getElementById('lives-container').innerHTML = `ç”Ÿå‘½å€¼: <span class="heart">${'â¤ï¸'.repeat(lives)}${'ğŸ–¤'.repeat(3-lives)}</span>`;
                if (lives <= 0) showEndScreen(false);
            }
        }

        function handleRightClick(r, c, cell) {
            if (playerGrid[r][c] === 1 || playerGrid[r][c] === -1) return;

            if (playerGrid[r][c] === 2) {
                playerGrid[r][c] = 0;
                cell.classList.remove('cross');
            } else {
                playerGrid[r][c] = 2;
                cell.classList.add('cross');
            }
        }

        function checkWin() {
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    if (solution[r][c] === 1 && playerGrid[r][c] !== 1) return;
                }
            }
            showEndScreen(true);
        }

        function showEndScreen(win) {
            isGameOver = true;
            const overlay = document.getElementById('overlay');
            const title = document.getElementById('overlay-title');
            const crown = document.getElementById('crown-icon');

            overlay.style.display = 'flex';
            if (win) {
                title.innerText = "èƒèŸ¹åœ‹ç‹è¬æ­²ï¼";
                title.style.color = "#ffcc00";
                crown.style.display = "block";
            } else {
                title.innerText = "æŒ‘æˆ°å¤±æ•—ï¼ŒèƒèŸ¹é€ƒèµ°äº†...";
                title.style.color = "#ff4d4d";
                crown.style.display = "none";
            }
        }

        // å•Ÿå‹•éŠæˆ²
        newGame();
    </script>
</body>
</html>