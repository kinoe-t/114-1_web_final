<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ¯æ—¥è‡ªå¾‹æ‰“å¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f4f9f4;
  --text:#2f4f2f;
  --sub:#4f6f4f;
  --primary:#4caf50;
  --secondary:#607d8b;
  --tree:#8b5a2b;
  --leaf:#4caf50;
}
body.dark{
  --bg:#121814;
  --text:#e0efe0;
  --sub:#9fb39f;
  --primary:#6fdc8c;
  --secondary:#90a4ae;
  --tree:#a97c50;
  --leaf:#6fdc8c;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,"Noto Sans TC",sans-serif;
  text-align:center;
  padding:36px 20px;
  transition:.3s;
}

button{
  margin:6px;
  padding:10px 20px;
  font-size:15px;
  border:none;
  border-radius:8px;
  background:var(--primary);
  color:#fff;
}
button.secondary{background:var(--secondary);}
button:disabled{opacity:.45}

.tree-area{
  height:260px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  margin:26px 0;
}

.tree{
  width:44px;
  background:var(--tree);
  border-radius:10px;
  position:relative;
}

.leaves{
  position:absolute;
  bottom:100%;
  left:50%;
  transform:translateX(-50%);
  background:var(--leaf);
  border-radius:50%;
}

.rings{
  position:absolute;
  bottom:0;
  width:100%;
}
.ring{
  height:2px;
  width:70%;
  margin:8px auto;
  background:rgba(255,255,255,.35);
  border-radius:2px;
}

.checklist{
  font-size:20px;
  margin:10px 0;
}

textarea{
  width:100%;
  max-width:460px;
  height:240px;
  margin-top:14px;
  padding:10px;
  background:var(--bg);
  color:var(--text);
  border:1px solid var(--sub);
}
</style>
</head>

<body>

<button id="modeBtn" class="secondary">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>

<h1>ğŸŒ± æ¯æ—¥è‡ªå¾‹æ‰“å¡</h1>
<p style="color:var(--sub)">æ—©ãƒ»ä¸­ãƒ»æ™šå„å®Œæˆä¸€æ¬¡</p>

<div class="tree-area">
  <div id="tree" class="tree">
    <div id="rings" class="rings"></div>
    <div id="leaves" class="leaves"></div>
  </div>
</div>

<div>
  <button id="morningBtn">ğŸŒ… æ—©</button>
  <button id="noonBtn">ğŸŒ ä¸­</button>
  <button id="nightBtn">ğŸŒ™ æ™š</button>
</div>

<div class="checklist" id="checklist">æ—© â–¢ã€€ä¸­ â–¢ã€€æ™š â–¢</div>

<p>ç´¯ç©å®Œæˆå¤©æ•¸ï¼š<span id="days">0</span> å¤©</p>
<p id="status"></p>

<button id="exportBtn" class="secondary">ğŸ“¤ åŒ¯å‡ºç´€éŒ„</button>
<textarea id="exportArea" readonly placeholder="é€™è£¡æœƒç”¢ç”Ÿç´”æ–‡å­—ç´€éŒ„èˆ‡çµ±è¨ˆæ‘˜è¦â€¦"></textarea>

<script>
const KEY="discipline_tree_final";
const MODE="ui_mode";

const btns={
  morning:morningBtn,
  noon:noonBtn,
  night:nightBtn
};

function today(){
  const d=new Date();
  return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
}
function hour(){return new Date().getHours();}
function period(){
  const h=hour();
  if(h>=5 && h<12) return "morning";
  if(h>=12 && h<18) return "noon";
  if(h>=18) return "night";
  return null;
}

function load(){
  return JSON.parse(localStorage.getItem(KEY)) || {
    date:today(),
    days:0,
    records:[],
    done:{morning:false,noon:false,night:false}
  };
}
function save(d){localStorage.setItem(KEY,JSON.stringify(d));}

function updateTree(days){
  const baseTrunk=110, baseLeaf=160;
  tree.style.height=(baseTrunk+days*10)+"px";
  leaves.style.width=(baseLeaf+days*6)+"px";
  leaves.style.height=(baseLeaf+days*6)+"px";
}

function updateRings(days){
  rings.innerHTML="";
  for(let i=0;i<days;i++){
    const r=document.createElement("div");
    r.className="ring";
    rings.appendChild(r);
  }
}

function refresh(d){
  checklist.textContent=
    "æ—© "+(d.done.morning?"âœ”":"â–¢")+"ã€€"+
    "ä¸­ "+(d.done.noon?"âœ”":"â–¢")+"ã€€"+
    "æ™š "+(d.done.night?"âœ”":"â–¢");

  days.textContent=d.days;

  Object.keys(btns).forEach(p=>{
    btns[p].disabled=d.done[p] || period()!==p;
  });

  status.textContent=
    d.done.morning&&d.done.noon&&d.done.night
    ?"ä»Šå¤©å·²å®Œæˆ âœ”":"ä»Šå¤©å°šæœªå®Œæˆ";

  updateTree(d.days);
  updateRings(d.days);
}

Object.keys(btns).forEach(p=>{
  btns[p].onclick=()=>{
    const d=load();
    if(d.date!==today()){
      d.date=today();
      d.done={morning:false,noon:false,night:false};
    }
    if(d.done[p]) return;

    d.done[p]=true;

    if(d.done.morning&&d.done.noon&&d.done.night){
      d.days++;
      d.records.push(d.date);
    }
    save(d);refresh(d);
  };
});

function weekCount(records){
  const n=new Date();
  const s=new Date(n);
  s.setDate(n.getDate()-n.getDay());
  return records.filter(d=>new Date(d)>=s).length;
}
function monthCount(records){
  const n=new Date();
  const ym=n.getFullYear()+"-"+(n.getMonth()+1);
  return records.filter(d=>d.startsWith(ym)).length;
}

exportBtn.onclick=()=>{
  const d=load();
  let t="æ¯æ—¥è‡ªå¾‹æ‰“å¡ç´€éŒ„\n----------------\n";
  d.records.forEach(r=>t+=r+" âœ”âœ”âœ”\n");
  t+="\nã€æœ¬é€±æ‘˜è¦ã€‘\nå®Œæˆå¤©æ•¸ï¼š"+weekCount(d.records)+" å¤©\n";
  t+="\nã€æœ¬æœˆæ‘˜è¦ã€‘\nå®Œæˆå¤©æ•¸ï¼š"+monthCount(d.records)+" å¤©\n";
  t+="\nç´¯ç©å®Œæˆå¤©æ•¸ï¼š"+d.days+" å¤©";
  exportArea.value=t;
};

// æ·±è‰²æ¨¡å¼
function applyMode(m){
  document.body.classList.toggle("dark",m==="dark");
  modeBtn.textContent=m==="dark"?"â˜€ï¸ æ·ºè‰²æ¨¡å¼":"ğŸŒ™ æ·±è‰²æ¨¡å¼";
  localStorage.setItem(MODE,m);
}
modeBtn.onclick=()=>{
  applyMode((localStorage.getItem(MODE)||"light")==="light"?"dark":"light");
};

// åˆå§‹åŒ–
applyMode(localStorage.getItem(MODE)||"light");
const d=load();
if(d.date!==today()){
  d.date=today();
  d.done={morning:false,noon:false,night:false};
  save(d);
}
refresh(d);
</script>

</body>
</html>

