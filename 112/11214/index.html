<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿå¡µé è¨€ - æ•´åˆç‰ˆ</title>

    <!-- Google Fonts å¼•å…¥ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=UoqMunThenKhung&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">

    <style>
        /* å…¨åŸŸå­—é«”è¨­å®š - ä½¿ç”¨å®‡æ–‡å¤©ç©¹å­—é«” */
        * {
            font-family: 'UoqMunThenKhung', serif;
        }

        /* å­—é«”å¹³æ»‘è™•ç† */
        body, h1, h2, h3, h4, h5, h6, p, span, div, button, input, textarea, select, small {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --gold: #ffd700;
            --phi: 1.618;
            --bg-color: #00050a;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* çµ±ä¸€çš„æ˜Ÿç©ºèƒŒæ™¯ç•«å¸ƒ */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
            will-change: auto; /* å„ªåŒ–æ¸²æŸ“æ•ˆèƒ½ */
        }

        /* æ˜Ÿåº§å‹•ç•«ç•«å¸ƒ */
        #constellation-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            will-change: opacity; /* å„ªåŒ–å‹•ç•«æ•ˆèƒ½ */
        }

        .container {
            position: relative;
            text-align: center;
            width: 90%;
            max-width: 600px;
            z-index: 10;
            will-change: transform; /* å„ªåŒ–å‹•ç•«æ•ˆèƒ½ */
        }

        /* æ–‡å­—å‹•ç•« */
        #display-text {
            font-size: 1.8rem;
            color: var(--gold);
            min-height: 2.5rem;
            letter-spacing: 5px;
            text-shadow: 0 0 15px var(--gold);
            will-change: transform, opacity;
            transition: transform 1.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 1s ease;
            transform: translateZ(0); /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
        }
        .text-rise {
            transform: translateY(-100px);
        }

        /* æ˜Ÿåº§é¸å–® */
        #zodiac-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s ease;
            margin-top: -50px;
        }
        .zodiac-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            cursor: pointer;
            transition: 0.3s;
            border-radius: 8px;
        }
        .zodiac-item:hover {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
        }

        /* åˆ†æå ±å‘Š */
        #result-screen {
            display: none;
            text-align: left;
            background: rgba(5, 5, 15, 0.95);
            padding: 40px;
            border: 1px solid var(--gold);
            border-radius: 10px;
            animation: fadeInBlur 2s ease-out forwards;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInBlur {
            from { opacity: 0; filter: blur(10px); transform: translateY(20px); }
            to { opacity: 1; filter: blur(0); transform: translateY(0); }
        }

        .res-row {
            margin: 18px 0;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 8px;
            opacity: 0;
            animation: slideInFromLeft 0.8s ease-out forwards;
        }

        /* ç‚ºæ¯å€‹é …ç›®è¨­å®šä¸åŒçš„å»¶é² */
        .res-row:nth-child(1) { animation-delay: 0.2s; }
        .res-row:nth-child(2) { animation-delay: 0.4s; }
        .res-row:nth-child(3) { animation-delay: 0.6s; }
        .res-row:nth-child(4) { animation-delay: 0.8s; }
        .res-row:nth-child(5) { animation-delay: 1s; }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .stars-glow {
            color: var(--gold);
            text-shadow: 0 0 8px var(--gold);
            font-size: 1.3rem;
            display: inline-block;
        }

        .color-center-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }
        .color-block {
            width: 33.33%;
            height: calc(33.33vw / var(--phi) / 3.5);
            max-height: 40px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px #000;
            font-size: 1rem;
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-ritual {
            padding: 15px 50px;
            background: transparent;
            color: var(--gold);
            border: 2px solid var(--gold);
            cursor: pointer;
            letter-spacing: 10px;
            transition: 0.5s;
            border-radius: 30px;
            font-size: 1.1rem;
        }
        .btn-ritual:hover {
            background: var(--gold);
            color: black;
            box-shadow: 0 0 20px var(--gold);
            transform: scale(1.05);
        }

        /* éŸ³æ•ˆé–‹é—œæŒ‰éˆ• */
        .audio-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--gold);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: 0.3s;
            z-index: 100;
        }
        .audio-toggle:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }
        .audio-toggle.active {
            background: rgba(255, 215, 0, 0.3);
        }

        @media (max-width: 600px) {
            #zodiac-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            #display-text {
                font-size: 1.2rem;
            }
        }

        /* ========== Loading å‹•ç•«æ¨£å¼ ========== */
        #loader-overlay {
            position: fixed;
            inset: 0;
            background: rgba(5, 6, 15, 0.98);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .loader-circle {
            width: 180px;
            height: 180px;
            border: 3px solid transparent;
            border-top: 3px solid #ffd700;
            border-bottom: 3px solid #ffd700;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            position: relative;
        }

        .loader-circle::before {
            content: "";
            position: absolute;
            inset: 15px;
            border: 3px solid transparent;
            border-left: 3px solid #fff;
            border-right: 3px solid #fff;
            border-radius: 50%;
            animation: spin-reverse 1.5s linear infinite;
        }

        .loading-text {
            margin-top: 40px;
            font-size: 2.2rem;
            letter-spacing: 12px;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            animation: loadingPulse 1.5s ease-in-out infinite;
            transition: opacity 0.3s ease;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes spin-reverse {
            to { transform: rotate(-360deg); }
        }
        @keyframes loadingPulse {
            0%, 100% {
                opacity: 0.5;
                transform: scale(0.95);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body>

    <!-- æ˜Ÿç©ºèƒŒæ™¯ç•«å¸ƒ -->
    <canvas id="starfield"></canvas>

    <!-- æ˜Ÿåº§å‹•ç•«ç•«å¸ƒ -->
    <canvas id="constellation-canvas"></canvas>

    <!-- éŸ³æ•ˆé–‹é—œæŒ‰éˆ• -->
    <div class="audio-toggle" id="audioToggle" title="èƒŒæ™¯éŸ³æ•ˆ">ğŸ”‡</div>

    <div class="container">
        <div id="welcome-screen">
            <h2 style="letter-spacing: 15px; font-weight: 400; font-size: 2rem;">å‘½é‹çš„æ˜Ÿç›¤æ­£åœ¨æ—‹è½‰</h2>
            <button class="btn-ritual" onclick="triggerRitual()">æ„ŸçŸ¥å‘½é‹</button>
        </div>

        <div id="action-area" style="display: none;">
            <div id="display-text"></div>
            <div id="zodiac-grid"></div>
        </div>

        <div id="result-screen">
            <div id="report-content"></div>
            <button class="btn-ritual" style="margin-top: 30px; width: 100%; font-size: 0.8rem;" onclick="location.reload()">é‡æ–°æ„Ÿæ‡‰</button>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ========== å®‡å®™èƒŒæ™¯éŸ³æ•ˆç³»çµ± ==========
            let audioCtx = null;
            let oscillators = [];
            let breathIntervals = [];

            function playSpaceAmbient() {
                if (audioCtx) return;

                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const frequencies = [65.41, 98.00];

                    frequencies.forEach((freq, index) => {
                        const osc = audioCtx.createOscillator();
                        const gainNode = audioCtx.createGain();

                        osc.type = 'sine';
                        osc.frequency.value = freq; // ç›´æ¥è¨­å€¼æ›´å¿«
                        gainNode.gain.value = 0.01;

                        // å„ªåŒ–çš„å‘¼å¸å¾ªç’°
                        function createBreathCycle() {
                            if (!audioCtx || audioCtx.state !== 'running') return;
                            const now = audioCtx.currentTime;
                            gainNode.gain.cancelScheduledValues(now);
                            gainNode.gain.setValueAtTime(gainNode.gain.value, now);
                            gainNode.gain.linearRampToValueAtTime(0.04, now + 4);
                            gainNode.gain.linearRampToValueAtTime(0.01, now + 8);
                        }

                        createBreathCycle();
                        const interval = setInterval(createBreathCycle, 8000);
                        breathIntervals.push(interval);

                        osc.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                        osc.start();

                        oscillators.push({ osc, gainNode });
                    });
                } catch (error) {
                    console.warn('éŸ³æ•ˆåˆå§‹åŒ–å¤±æ•—:', error);
                }
            }

            function stopSpaceAmbient() {
                if (!audioCtx) return;

                // æ¸…é™¤æ‰€æœ‰é–“éš”
                breathIntervals.forEach(interval => clearInterval(interval));
                breathIntervals = [];

                // åœæ­¢æ‰€æœ‰æŒ¯ç›ªå™¨
                oscillators.forEach(({ osc, gainNode }) => {
                    try {
                        gainNode.gain.cancelScheduledValues(audioCtx.currentTime);
                        gainNode.gain.setValueAtTime(gainNode.gain.value, audioCtx.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                        setTimeout(() => {
                            try { osc.stop(); } catch(e) {}
                        }, 500);
                    } catch(e) {}
                });

                oscillators = [];

                setTimeout(() => {
                    if (audioCtx) {
                        audioCtx.close();
                        audioCtx = null;
                    }
                }, 600);
            }

            // ========== æ˜Ÿç©ºèƒŒæ™¯ç³»çµ± ==========
            const starfield = document.getElementById('starfield');
            const starCtx = starfield.getContext('2d');
            let stars = [];
            const starCount = 300; // å¾ 400 é™åˆ° 300 æå‡æ•ˆèƒ½
            let meteors = [];
            let lastTime = 0;

            function initStarfield() {
                starfield.width = window.innerWidth;
                starfield.height = window.innerHeight;
                stars = [];
                const width = starfield.width;
                const height = starfield.height;

                // æ‰¹æ¬¡å‰µå»ºæ˜Ÿæ˜Ÿï¼Œæ¸›å°‘è¿´åœˆé–‹éŠ·
                for (let i = 0; i < starCount; i++) {
                    stars.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        size: Math.random() * 0.8 + 0.3,
                        opacity: Math.random(),
                        speed: Math.random() * 0.015 + 0.005,
                        maxOpacity: Math.random() * 0.5 + 0.5 // é è¨ˆç®—æœ€å¤§é€æ˜åº¦
                    });
                }
            }

            function drawStarfield(currentTime) {
                // ä½¿ç”¨æ™‚é–“æˆ³æ§åˆ¶æ›´æ–°é »ç‡
                const deltaTime = currentTime - lastTime;

                if (deltaTime < 16) { // é™åˆ¶åœ¨ 60 FPS
                    requestAnimationFrame(drawStarfield);
                    return;
                }
                lastTime = currentTime;

                // æ¸…é™¤ç•«å¸ƒ
                starCtx.clearRect(0, 0, starfield.width, starfield.height);

                // æ‰¹æ¬¡è¨­å®š shadow å±¬æ€§ï¼Œæ¸›å°‘ç‹€æ…‹åˆ‡æ›
                const now = Date.now();

                // ç¹ªè£½æ˜Ÿæ˜Ÿ - å„ªåŒ–è¿´åœˆ
                for (let i = 0; i < stars.length; i++) {
                    const s = stars[i];
                    s.opacity += s.speed;

                    if (s.opacity > s.maxOpacity || s.opacity < 0.1) {
                        s.speed = -s.speed;
                    }

                    starCtx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
                    starCtx.shadowBlur = s.size * 3;
                    starCtx.shadowColor = 'white';
                    starCtx.beginPath();
                    starCtx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                    starCtx.fill();
                }

                starCtx.shadowBlur = 0; // é‡ç½® shadow

                // æµæ˜Ÿæ•ˆæœ - é™ä½ç”Ÿæˆé »ç‡
                if (Math.random() < 0.005) {
                    meteors.push({
                        x: Math.random() * starfield.width,
                        y: Math.random() * starfield.height * 0.3,
                        len: Math.random() * 80 + 40,
                        speed: Math.random() * 10 + 8,
                        birthTime: now
                    });
                }

                // åå‘éæ­·ï¼Œé¿å…åˆªé™¤å…ƒç´ æ™‚çš„ç´¢å¼•å•é¡Œ
                for (let i = meteors.length - 1; i >= 0; i--) {
                    const m = meteors[i];
                    const age = now - m.birthTime;

                    if (age > 1000 || m.y > starfield.height || m.x < -m.len) {
                        meteors.splice(i, 1);
                        continue;
                    }

                    m.x -= m.speed;
                    m.y += m.speed;

                    const opacity = 0.4 * (1 - age / 1000);
                    starCtx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;
                    starCtx.lineWidth = 1.5;
                    starCtx.beginPath();
                    starCtx.moveTo(m.x, m.y);
                    starCtx.lineTo(m.x + m.len, m.y - m.len);
                    starCtx.stroke();
                }

                requestAnimationFrame(drawStarfield);
            }

            // ========== æ˜Ÿåº§é‹å‹¢ç³»çµ± ==========
            const zodiacs = [
                { name: "ç‰¡ç¾Šåº§", icon: "â™ˆ", points: [[100,200], [180,120], [280,150], [320,220]] },
                { name: "é‡‘ç‰›åº§", icon: "â™‰", points: [[50,100], [150,200], [230,210], [330,150], [380,80]] },
                { name: "é›™å­åº§", icon: "â™Š", points: [[120,80], [120,320], [240,80], [240,320], [120,200], [240,200]] },
                { name: "å·¨èŸ¹åº§", icon: "â™‹", points: [[200,80], [200,200], [140,280], [260,280]] },
                { name: "ç…å­åº§", icon: "â™Œ", points: [[350,250], [250,280], [180,240], [150,150], [250,120], [300,180]] },
                { name: "è™•å¥³åº§", icon: "â™", points: [[80,80], [150,200], [220,200], [280,140], [350,250], [220,320]] },
                { name: "å¤©ç§¤åº§", icon: "â™", points: [[200,80], [130,200], [270,200], [200,320]] },
                { name: "å¤©è åº§", icon: "â™", points: [[80,120], [180,120], [220,220], [190,300], [120,340], [260,340]] },
                { name: "å°„æ‰‹åº§", icon: "â™", points: [[150,150], [280,150], [210,280], [210,80], [150,340]] },
                { name: "æ‘©ç¾¯åº§", icon: "â™‘", points: [[80,150], [200,340], [320,150], [200,210]] },
                { name: "æ°´ç“¶åº§", icon: "â™’", points: [[80,150], [150,120], [220,180], [290,150], [360,210]] },
                { name: "é›™é­šåº§", icon: "â™“", points: [[80,80], [210,210], [340,80], [210,340]] }
            ];

            const saturatedColors = [
                { n: "æ¥µè‡´è‰·ç´…", c: "#FF0000" },
                { n: "äº®éº—é›è—", c: "#0000FF" },
                { n: "æ´»åŠ›äº®æ©˜", c: "#FF8C00" },
                { n: "ç¥ç¥•æ·±ç´«", c: "#800080" },
                { n: "è¢å…‰ç¿ ç¶ ", c: "#00FF00" },
                { n: "æ·±æµ·æ¹›è—", c: "#1E90FF" },
                { n: "å¥¢è¯æ¿ƒé‡‘", c: "#B8860B" },
                { n: "é£½å’Œç«ç‘°", c: "#E91E63" },
                { n: "å¯¶çŸ³ç´…", c: "#DC143C" },
                { n: "å­”é›€è—", c: "#20B2AA" },
                { n: "è–°è¡£è‰ç´«", c: "#9370DB" },
                { n: "æª¸æª¬é»ƒ", c: "#FFD700" },
                { n: "æ£®æ—ç¶ ", c: "#228B22" },
                { n: "çŠç‘šæ©˜", c: "#FF7F50" },
                { n: "åˆå¤œè—", c: "#191970" },
                { n: "é…’ç´…è‰²", c: "#8B0000" },
                { n: "æ¹–æ°´ç¶ ", c: "#00CED1" },
                { n: "èœœæ¡ƒç²‰", c: "#FFB6C1" },
                { n: "ç¥ç€é‡‘", c: "#FFBF00" },
                { n: "é’ç“·ç¶ ", c: "#7FFFD4" }
            ];

            const soupLib = [
                "ã€Œä½ æ‰€è¿½æ±‚çš„ï¼Œä¹Ÿæ­£ç«ç†±åœ°è¿½æ±‚è‘—ä½ ã€‚ã€",
                "ã€Œæ˜Ÿè¾°åœ¨é»‘å¤œæœ€æ·±è™•ï¼ŒæŒ‡å¼•æœ€æ˜äº®çš„è·¯ã€‚ã€",
                "ã€Œæº«æŸ”çš„åŠ›é‡ï¼Œè¶³ä»¥æŠµæ“‹ä¸–é–“æ‰€æœ‰çš„å¯’å†·ã€‚ã€",
                "ã€Œå‹‡æ•¢å˜—è©¦ï¼Œå‘½é‹ä¾¿æœƒç‚ºä½ é–‹é—¢æ–°å¾‘ã€‚ã€",
                "ã€Œç•¶ä½ æ”¾æ…¢è…³æ­¥ï¼Œæ‰èƒ½çœ‹æ¸…æ˜Ÿè»Œçš„èµ°å‘ã€‚ã€",
                "ã€Œæº«æŸ”åœ°å°å¾…è‡ªå·±ï¼Œæ˜¯ä»Šæ—¥æœ€é‡è¦çš„ä¿®è¡Œã€‚ã€",
                "ã€Œæ˜Ÿç©ºä¸èªï¼Œä½†å®ƒçµ¦äº†ä½ æ‰€æœ‰é—œæ–¼åŠ›é‡çš„ç­”æ¡ˆã€‚ã€",
                "ã€Œå®‡å®™å¾ä¸åœ¨æ­¤åˆ»æ­¢æ­¥ï¼Œä½ çš„å…‰èŠ’äº¦ç„¶ã€‚ã€",
                "ã€Œç›¸ä¿¡éç¨‹ï¼Œæ¯å€‹ç•¶ä¸‹éƒ½åœ¨ç‚ºæœªä¾†é‹ªè·¯ã€‚ã€",
                "ã€Œä½ çš„å­˜åœ¨æœ¬èº«ï¼Œå°±æ˜¯å®‡å®™çš„æ©è³œã€‚ã€",
                "ã€Œæ¥ç´ä¸å®Œç¾ï¼Œé‚£æ˜¯æˆé•·çš„å°è¨˜ã€‚ã€",
                "ã€Œæ²‰é»˜æœ‰æ™‚ï¼Œä¹Ÿæ˜¯ä¸€ç¨®æ·±åˆ»çš„å›æ‡‰ã€‚ã€",
                "ã€Œåˆ¥æ€•å­¤ç¨ï¼Œé‚£æ˜¯èˆ‡è‡ªå·±å°è©±çš„æ™‚åˆ»ã€‚ã€",
                "ã€Œæ¯å€‹è½‰æŠ˜ï¼Œéƒ½è—è‘—æ–°çš„å¯èƒ½æ€§ã€‚ã€",
                "ã€Œé †æ‡‰æ½®æ±ï¼Œä½ æœƒç™¼ç¾æ›´å»£é—Šçš„æµ·æ´‹ã€‚ã€",
                "ã€Œå–„å¾…æ­¤åˆ»çš„è‡ªå·±ï¼Œæœªä¾†æœƒæ„Ÿè¬ä½ ã€‚ã€",
                "ã€Œæ˜Ÿå…‰ç©¿è¶Šå„„è¬å¹´æ‰æŠµé”ä½ çœ¼ä¸­ï¼Œä½ çš„åŠªåŠ›ä¹Ÿæ˜¯ã€‚ã€",
                "ã€Œä¸æ˜¯æ‰€æœ‰å•é¡Œéƒ½éœ€è¦ç«‹å³çš„ç­”æ¡ˆã€‚ã€",
                "ã€Œä½ æ“æœ‰çš„ï¼Œæ¯”ä½ æ„è­˜åˆ°çš„æ›´å¤šã€‚ã€",
                "ã€Œé¢¨æœƒè¨˜å¾—æ¯ä¸€æœµèŠ±çš„é¦™æ°£ï¼Œä¸–ç•Œä¹Ÿæœƒè¨˜å¾—ä½ çš„å–„æ„ã€‚ã€"
            ];

            // é‹å‹¢æè¿°è³‡æ–™åº«ï¼ˆå¯Œå«æƒ…ç·’åƒ¹å€¼ã€ç”Ÿæ´»åŒ–ã€æ˜“æ‡‚ï¼‰
            const fortuneDescriptions = {
                study: [
                    "ä»Šå¤©çš„ä½ æ€è·¯ç‰¹åˆ¥æ¸…æ™°ï¼Œæ˜¯ææ‡‚é›£é¡Œçš„å¥½æ™‚æ©Ÿ",
                    "è¨˜æ†¶åŠ›å¤§çˆ†ç™¼çš„ä¸€å¤©ï¼Œè¶•å¿«è¤‡ç¿’é‡è¦çš„å…§å®¹å§",
                    "å­¸ç¿’æ•ˆç‡è¶…é«˜ï¼ŒåŸæœ¬çœ‹ä¸æ‡‚çš„ç¾åœ¨çªç„¶å°±æ˜ç™½äº†",
                    "åˆ¥æ€¥è‘—è¶•é€²åº¦ï¼Œæ…¢æ…¢ç†è§£æ¯”æ­»èƒŒæ›´é‡è¦",
                    "æ‰¾å€‹å¤¥ä¼´ä¸€èµ·è¨è«–ï¼Œæ•™åˆ¥äººçš„éç¨‹ä½ æœƒå­¸å¾—æ›´å¥½",
                    "éˆæ„Ÿæ»¿æ»¿çš„ä¸€å¤©ï¼Œé©åˆå­¸ç¿’éœ€è¦å‰µæ„çš„ç§‘ç›®",
                    "è©¦è©¦çœ‹æ›å€‹æ–¹å¼å­¸ç¿’ï¼Œæœƒæœ‰æ„æƒ³ä¸åˆ°çš„æ”¶ç©«",
                    "è¡¨é”èƒ½åŠ›è®Šå¼·äº†ï¼Œæ˜¯å±•ç¾å­¸ç¿’æˆæœçš„å¥½æ—¥å­",
                    "è—è¡“å’Œç¾æ„Ÿé¡çš„å­¸ç¿’ç‰¹åˆ¥æœ‰æ„Ÿè¦ºï¼Œè·Ÿè‘—ç›´è¦ºèµ°",
                    "å°ˆæ³¨åŠ›åœ¨ç·šï¼Œé©åˆå•ƒé‚£äº›éœ€è¦æ·±åº¦æ€è€ƒçš„ç¡¬éª¨é ­",
                    "è‡ªä¿¡å¿ƒçˆ†æ£šï¼Œå‹‡æ•¢èˆ‰æ‰‹ç™¼è¨€å§",
                    "æƒ…ç·’è¨˜æ†¶æ³•å¾ˆæœ‰æ•ˆï¼ŒæŠŠçŸ¥è­˜è·Ÿæ„Ÿå—é€£çµèµ·ä¾†",
                    "å­¸ç¿’éç¨‹å¾ˆæ„‰å¿«ï¼Œä¿æŒé€™ä»½å¥½å¿ƒæƒ…ç¹¼çºŒå‰é€²",
                    "è¡Œå‹•åŠ›åè¶³ï¼Œä¸»å‹•å­¸ç¿’æ•ˆæœåŠ å€",
                    "ç…§é¡§å¥½èº«é«”ï¼Œåƒé£½ç¡å¥½æ‰èƒ½å°ˆå¿ƒè®€æ›¸",
                    "ç­–ç•¥æ€§æ€è€ƒèƒ½åŠ›é–‹æ›ï¼Œé©åˆè¦åŠƒå­¸ç¿’è¨ˆç•«",
                    "æ¸›å°‘å¹²æ“¾æºï¼Œå°ˆå¿ƒåšä¸€ä»¶äº‹æƒ…æ•ˆæœæœ€å¥½",
                    "åœ˜é«”ä½œæ¥­é‹å‹¢ä½³ï¼Œåˆä½œå­¸ç¿’äº‹åŠåŠŸå€",
                    "è·Ÿè‘—èˆˆè¶£èµ°ï¼Œå­¸è‡ªå·±å–œæ­¡çš„æ±è¥¿ä¸æœƒç´¯",
                    "å›é ­è¤‡ç¿’èˆŠçŸ¥è­˜ï¼Œæœƒç™¼ç¾ä»¥å‰æ²’æ³¨æ„åˆ°çš„é‡é»"
                ],
                money: [
                    "éŒ¢åŒ…å‡ºå…¥é »ç¹çš„ä¸€å¤©ï¼Œè¨˜å¾—è¨˜å¸³çœ‹æ¸…æ¥šæµå‘",
                    "é©åˆåšé•·é è¦åŠƒï¼Œåˆ¥åªçœ‹çœ¼å‰çš„å°åˆ©",
                    "ç›¸ä¿¡ä½ çš„ç¬¬å…­æ„Ÿï¼Œå¯èƒ½æœƒç™¼ç¾éš±è—çš„å°æ©Ÿæœƒ",
                    "ç†æ€§æ€è€ƒæœ€é‡è¦ï¼Œåˆ¥è¢«ä¸€æ™‚è¡å‹•å½±éŸ¿åˆ¤æ–·",
                    "å¥½å¥½æ•´ç†ä¸€ä¸‹ç¾æœ‰çš„è³‡æºï¼Œå¯èƒ½æ¯”ä½ æƒ³çš„é‚„å¤š",
                    "è²¡é‹æœ‰æˆé•·ç©ºé–“ï¼Œä¿æŒæ¨‚è§€ä½†åˆ¥å¤ªè²ªå¿ƒ",
                    "ç©©ç©©èµ°æ¯”å†’éšªå¥½ï¼Œæ…¢æ…¢ç´¯ç©æ‰æ˜¯ç‹é“",
                    "å¯èƒ½æœ‰æ„å¤–ä¹‹è²¡ï¼Œç•™æ„èº«é‚Šçš„æ©Ÿæœƒ",
                    "åˆ¥åšå¤ªç†æƒ³åŒ–çš„æŠ•è³‡ï¼Œå¯¦éš›ä¸€é»æ›´å®‰å…¨",
                    "å¯èƒ½éœ€è¦èª¿æ•´ç†è²¡æ–¹å¼ï¼ŒèˆŠæ–¹æ³•ä¸ä¸€å®šé©ç”¨äº†",
                    "ä»Šå¤©ç‰¹åˆ¥èƒ½çœ‹æ¸…æ”¶æ”¯ç‹€æ³ï¼Œæ˜¯æª¢è¦–é ç®—çš„å¥½æ—¥å­",
                    "å°å¿ƒæƒ…ç·’åŒ–æ¶ˆè²»ï¼Œæƒ³è²·æ±è¥¿å‰å…ˆå•è‡ªå·±çœŸçš„éœ€è¦å—",
                    "é©åˆåšè²¡å‹™è¦åŠƒï¼Œåˆ—å€‹æ¸…å–®æŠŠå¸³ç›®ç†æ¸…æ¥š",
                    "ç©æ¥µè¡Œå‹•æœƒæœ‰å›å ±ï¼Œè©²çˆ­å–çš„åˆ¥å®¢æ°£",
                    "å¯èƒ½æœ‰å°ç¢ºå¹¸ï¼Œä½†åˆ¥æœŸå¾…å¤ªé«˜",
                    "çæƒœæ‰‹é‚Šçš„è³‡æºï¼Œä¸æµªè²»å°±æ˜¯è³ºåˆ°",
                    "ç”¨è…¦è¢‹è³ºéŒ¢çš„å¥½æ—¥å­ï¼Œè°æ˜ç†è²¡å‹éçæ‹š",
                    "æŠŠéŒ¢èŠ±åœ¨åˆ€å£ä¸Šï¼Œåªè²·çœŸæ­£éœ€è¦çš„æ±è¥¿",
                    "åˆå¤¥æˆ–å…±åŒæŠ•è³‡è¦è¬¹æ…è©•ä¼°ï¼Œåˆ¥è¡å‹•æ±ºå®š",
                    "é‡å»ºå¥åº·çš„é‡‘éŒ¢è§€ï¼Œåˆ¥è®“éå»çš„ç¶“é©—é™åˆ¶ä½ "
                ],
                overall: [
                    "å¿ƒæƒ…å¹³éœçš„ä¸€å¤©ï¼Œé©åˆè½è½å…§å¿ƒçœŸæ­£çš„è²éŸ³",
                    "ä»Šå¤©ç·£åˆ†ç‰¹åˆ¥å¥½ï¼Œå¯èƒ½æœƒé‡åˆ°é‡è¦çš„äºº",
                    "éœ€è¦ä¸€é»å®‰éœç©ºé–“ï¼Œç¨è™•ä¹Ÿæ˜¯ä¸€ç¨®å……é›»",
                    "æ´»åŠ›æ»¿æ»¿ï¼Œåšä»€éº¼éƒ½é †å¿ƒï¼Œç›¡æƒ…å±•ç¾è‡ªå·±å§",
                    "æ…¢æ…¢ä¾†ï¼Œä¸è¦æ€¥ï¼Œå®‡å®™æœƒçµ¦ä½ æœ€å¥½çš„å®‰æ’",
                    "é™½å…‰èˆ¬çš„ä¸€å¤©ï¼Œå……æ»¿å¸Œæœ›å’Œæ­£èƒ½é‡",
                    "æƒ…ç·’æ„Ÿå—ç‰¹åˆ¥æ•éŠ³ï¼Œå¥½å¥½ç…§é¡§è‡ªå·±çš„å¿ƒ",
                    "æºé€šè¡¨é”è¶…é †æš¢ï¼Œè©²èªªçš„è©±å°±å¤§è†½èªªå‡ºä¾†",
                    "åšä»€éº¼éƒ½å……æ»¿å¹¹å‹ï¼Œè¶è‘—é€™è‚¡ç†±æƒ…å¤šå®Œæˆé»äº‹",
                    "å¥½é‹æ°£åœ¨èº«é‚Šï¼Œä¿æŒæ¨‚è§€æ…‹åº¦æœƒå¸å¼•æ›´å¤šå¥½äº‹",
                    "è¸å¯¦åšäº‹çš„ä¸€å¤©ï¼ŒåŠªåŠ›ä¸æœƒç™½è²»",
                    "ä¿æŒé–‹æ”¾å¿ƒæ…‹ï¼Œé©šå–œå¯èƒ½å°±åœ¨è½‰è§’",
                    "ç›¸ä¿¡ç›´è¦ºï¼Œä½ çš„ç¬¬å…­æ„Ÿä»Šå¤©ç‰¹åˆ¥æº–",
                    "è›»è®Šçš„é—œéµæ™‚åˆ»ï¼Œå‹‡æ•¢é¢å°æ”¹è®Šå§",
                    "é­…åŠ›çˆ†æ£šçš„ä¸€å¤©ï¼Œä½ æœƒç‰¹åˆ¥å¸å¼•åˆ¥äººæ³¨æ„",
                    "ç›®æ¨™æ¸…æ™°ï¼ŒçŸ¥é“è‡ªå·±è¦ä»€éº¼å°±å»åš",
                    "äººéš›é—œä¿‚å’Œè«§ï¼Œè·Ÿå¤§å®¶ç›¸è™•æ„‰å¿«",
                    "å›å®¶ä¼‘æ¯ç‰¹åˆ¥èˆ’é©ï¼Œå¥½å¥½æ”¾é¬†äº«å—",
                    "æœè‘—å°çš„æ–¹å‘å‰é€²ï¼Œç›¸ä¿¡è‡ªå·±çš„é¸æ“‡",
                    "å¾éå»ç¶“é©—ä¸­å­¸åˆ°çš„æ™ºæ…§ï¼Œä»Šå¤©ç”¨å¾—ä¸Š"
                ]
            };

            async function type(text, elId, speed = 80) {
                const el = document.getElementById(elId);
                el.textContent = ""; // ä½¿ç”¨ textContent æ›´å¿«

                // ä½¿ç”¨ textContent é€å­—æ·»åŠ ï¼ˆæ¯” innerHTML æ›´å¿«ï¼‰
                for (let i = 0; i < text.length; i++) {
                    el.textContent += text[i];
                    await new Promise(r => setTimeout(r, speed));
                }
                await new Promise(r => setTimeout(r, 800));
            }

            window.triggerRitual = async function() {
                document.getElementById('welcome-screen').style.display = 'none';
                document.getElementById('action-area').style.display = 'block';

                // é¡¯ç¤ºæ—¥æœŸ
                const now = new Date();
                const dateStr = `æ™‚ç©ºåº§æ¨™ï¼š${now.getFullYear()} / ${now.getMonth()+1} / ${now.getDate()}`;
                await type(dateStr, 'display-text', 100);

                // æ—¥æœŸæ·¡å‡º
                document.getElementById('display-text').style.opacity = "0";
                await new Promise(r => setTimeout(r, 800));
                document.getElementById('display-text').innerHTML = "";
                document.getElementById('display-text').style.opacity = "1";

                // å¼•å°èªæ‰“å­—
                await type("è«‹æ„Ÿæ‡‰æ˜Ÿè¾°ï¼Œé¸æ“‡ä½ çš„æœ¬å‘½æ˜Ÿåº§", 'display-text', 80);

                // ä¸Šå‡å‹•ç•«
                document.getElementById('display-text').classList.add('text-rise');
                await new Promise(r => setTimeout(r, 800));

                const grid = document.getElementById('zodiac-grid');
                grid.style.visibility = "visible";
                grid.style.opacity = "1";
                renderZodiacs();
            };

            function renderZodiacs() {
                const grid = document.getElementById('zodiac-grid');
                if (grid.children.length > 0) return; // é¿å…é‡è¤‡æ¸²æŸ“

                // ä½¿ç”¨ DocumentFragment æ‰¹æ¬¡æ“ä½œ DOM
                const fragment = document.createDocumentFragment();

                zodiacs.forEach(z => {
                    const div = document.createElement('div');
                    div.className = 'zodiac-item';
                    div.innerHTML = `<span style="font-size:1.6em;display:block;">${z.icon}</span><small>${z.name}</small>`;
                    div.onclick = () => runConstellation(z);
                    fragment.appendChild(div);
                });

                grid.appendChild(fragment); // ä¸€æ¬¡æ€§æ’å…¥ï¼Œæ¸›å°‘ reflow
            }

            async function runConstellation(z) {
                document.getElementById('zodiac-grid').style.display = 'none';
                const textEl = document.getElementById('display-text');
                textEl.classList.remove('text-rise');
                textEl.style.transform = "translateY(0)";
                textEl.style.opacity = '0';

                // === å‰µå»º Loading Overlay ===
                const loaderOverlay = document.createElement('div');
                loaderOverlay.id = 'loader-overlay';
                loaderOverlay.innerHTML = `
                    <div class="loader-circle"></div>
                    <div class="loading-text">å°ˆå±¬æ–¼ä½ çš„é è¨€æ­£åœ¨å‡èš</div>
                `;
                document.body.appendChild(loaderOverlay);

                // æ·¡å…¥ Loading
                setTimeout(() => {
                    loaderOverlay.style.display = 'flex';
                    setTimeout(() => { loaderOverlay.style.opacity = '1'; }, 50);
                }, 300);

                // === ç­‰å¾… 2.5 ç§’ ===
                await new Promise(r => setTimeout(r, 2500));

                // === æ·¡å‡º Loadingï¼Œé¡¯ç¤ºå ±å‘Š ===
                loaderOverlay.style.opacity = '0';
                await new Promise(r => setTimeout(r, 500));
                loaderOverlay.remove();

                showReport(z.name);
            }

            function showReport(name) {
                const actionArea = document.getElementById('action-area');
                const constCanvas = document.getElementById('constellation-canvas');
                const resultScreen = document.getElementById('result-screen');

                actionArea.style.display = 'none';
                constCanvas.style.display = 'none';
                resultScreen.style.display = 'block';

                const now = new Date();

                // å„ªåŒ–ç¨®å­è¨ˆç®—
                let nameHash = 0;
                for (let i = 0; i < name.length; i++) {
                    nameHash += name.charCodeAt(i) * (i + 1);
                }

                const baseSeed = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
                const uniqueSeed = baseSeed * 1000 + nameHash;

                // ä½¿ç”¨ä½é‹ç®—å„ªåŒ–éš¨æ©Ÿå‡½æ•¸
                const rand = (offset) => {
                    const x = Math.sin(uniqueSeed + offset * 12345) * 10000;
                    return Math.abs(x - Math.floor(x));
                };

                // é è¨ˆç®—æ‰€æœ‰éš¨æ©Ÿç´¢å¼•
                const indices = {
                    study: Math.floor(rand(100) * 20),
                    money: Math.floor(rand(200) * 20),
                    overall: Math.floor(rand(300) * 20),
                    color: Math.floor(rand(400) * 20),
                    soup: Math.floor(rand(500) * 20)
                };

                // ç”Ÿæˆæ˜Ÿç´š HTMLï¼ˆå¿«å–æ¨¡æ¿ï¼‰
                const starsHTML = (offset) => {
                    const count = Math.floor(rand(offset) * 6);
                    return `<span class="stars-glow">${'â˜…'.repeat(count)}</span>${'â˜†'.repeat(5 - count)}`;
                };

                // ä½¿ç”¨æ¨¡æ¿å­—ä¸²ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆ HTML
                const reportHTML = `
                    <div class="res-row" style="text-align:center; font-size:2rem; color:var(--gold); border:none; letter-spacing:5px;">${name}</div>
                    <div class="res-row">
                        <div style="margin-bottom:8px;">å­¸ç¿’é‹å‹¢ï¼š${starsHTML(1)}</div>
                        <div style="font-size:0.9rem; opacity:0.7; line-height:1.6;">${fortuneDescriptions.study[indices.study]}</div>
                    </div>
                    <div class="res-row">
                        <div style="margin-bottom:8px;">é‡‘éŒ¢é‹å‹¢ï¼š${starsHTML(2)}</div>
                        <div style="font-size:0.9rem; opacity:0.7; line-height:1.6;">${fortuneDescriptions.money[indices.money]}</div>
                    </div>
                    <div class="res-row">
                        <div style="margin-bottom:8px;">æ•´é«”é‹å‹¢ï¼š${starsHTML(3)}</div>
                        <div style="font-size:0.9rem; opacity:0.7; line-height:1.6;">${fortuneDescriptions.overall[indices.overall]}</div>
                    </div>
                    <div class="res-row" style="border:none;">
                        <div class="color-center-box">
                            <span style="margin-bottom:10px; font-size:0.9rem; opacity:0.8;">ä»Šæ—¥å¹¸é‹è‰²</span>
                            <div class="color-block" style="background:${saturatedColors[indices.color].c}">${saturatedColors[indices.color].n}</div>
                        </div>
                    </div>
                    <div style="text-align:center; font-style:italic; color:#aab; margin-top:20px; font-size:1.1rem; font-family: 'ZCOOL XiaoWei', serif;">${soupLib[indices.soup]}</div>
                `;

                document.getElementById('report-content').innerHTML = reportHTML;
            }

            // åˆå§‹åŒ–èˆ‡äº‹ä»¶ç›£è½
            initStarfield();
            drawStarfield(0);

            // é˜²æŠ–å‹•å„ªåŒ– resize äº‹ä»¶
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    initStarfield();
                }, 250); // 250ms é˜²æŠ–å‹•
            });

            // ========== éŸ³æ•ˆé–‹é—œæ§åˆ¶ ==========
            let audioEnabled = false;
            const audioToggle = document.getElementById('audioToggle');

            audioToggle.addEventListener('click', () => {
                audioEnabled = !audioEnabled;

                if (audioEnabled) {
                    playSpaceAmbient();
                    audioToggle.textContent = 'ğŸ”Š';
                    audioToggle.classList.add('active');
                    audioToggle.title = 'é»æ“Šé—œé–‰éŸ³æ•ˆ';
                } else {
                    stopSpaceAmbient();
                    audioToggle.textContent = 'ğŸ”‡';
                    audioToggle.classList.remove('active');
                    audioToggle.title = 'é»æ“Šé–‹å•ŸéŸ³æ•ˆ';
                }
            });
        })();
    </script>
</body>
</html>
