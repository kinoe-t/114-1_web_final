<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»å‹™ç®¡ç†ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-display {
            font-size: 24px;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .nav-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 16px;
        }

        .nav-tab:hover {
            background: #e0e0e0;
        }

        .nav-tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .task-form {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-container input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 50px;
            font-weight: bold;
            color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .task-list {
            display: grid;
            gap: 20px;
        }

        .task-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            user-select: none;
        }

        .task-card[draggable="true"] {
            cursor: move;
        }

        .task-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        .task-card.dragging {
            opacity: 0.5;
        }

        .task-card.completed-card {
            background: #f5f5f5;
            border-color: #4caf50;
        }

        .task-card.completed-card .task-title {
            color: #4caf50;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .task-type {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .type-personal { background: #e3f2fd; color: #1976d2; }
        .type-weekly { background: #f3e5f5; color: #7b1fa2; }
        .type-learning { background: #e8f5e9; color: #388e3c; }
        .type-other { background: #fff3e0; color: #f57c00; }

        .task-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }

        .task-deadline {
            font-weight: bold;
        }

        .deadline-ok { color: #4caf50; }
        .deadline-overdue { color: #f44336; }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            flex: 1;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .calendar-section {
            margin-top: 30px;
        }

        .calendar-month {
            border: 2px solid #ddd;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: white;
        }

        .calendar-day-header {
            padding: 10px;
            text-align: center;
            background: #f5f5f5;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .calendar-day {
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            background: white;
            position: relative;
        }

        .calendar-day.drag-over {
            background: #e3f2fd;
        }

        .calendar-day.other-month {
            background: #f9f9f9;
            color: #999;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .calendar-task {
            background: #667eea;
            color: white;
            padding: 5px;
            margin: 3px 0;
            border-radius: 5px;
            font-size: 11px;
            cursor: pointer;
        }

        .calendar-deadline {
            background: #f44336;
            color: white;
            padding: 5px;
            margin: 3px 0;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
        }

        .calendar-period {
            background: #4caf50;
            color: white;
            padding: 3px;
            margin: 2px 0;
            border-radius: 3px;
            font-size: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .note-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #ddd;
        }

        .note-content {
            background: #fff9e6;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .note-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 60px;
        }

        .completed-date {
            color: #4caf50;
            font-weight: bold;
            font-size: 14px;
        }

        .completed-count {
            font-size: 20px;
            font-weight: bold;
            color: #4caf50;
            background: #e8f5e9;
            padding: 10px 20px;
            border-radius: 10px;
        }

        .btn-delete-small {
            padding: 5px 12px;
            font-size: 12px;
            background: #f44336;
            color: white;
        }

        .subtasks-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #ddd;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .subtask-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .subtask-text {
            flex: 1;
            font-size: 14px;
        }

        .subtask-text.completed {
            text-decoration: line-through;
            color: #999;
        }

        .subtask-delete {
            padding: 3px 8px;
            font-size: 12px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .subtask-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .subtask-input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn-add-subtask {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .date-picker-icon {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .date-picker-icon input[type="date"] {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 1;
        }

        .calendar-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-icon:hover {
            background: #5568d3;
            transform: scale(1.1);
        }

        .input-with-calendar {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .input-with-calendar input[type="text"] {
            flex: 1;
        }

        .points-form {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .reward-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .reward-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        .reward-info {
            flex: 1;
        }

        .reward-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .reward-points {
            color: #667eea;
            font-weight: bold;
        }

        .reward-actions {
            display: flex;
            gap: 10px;
        }

        .history-card {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .history-date {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        img, svg, .task-type, .task-title, .task-info, .progress-bar, 
        .subtask-item, .note-content, .completed-count, .reward-info {
            user-select: none;
            -webkit-user-drag: none;
            pointer-events: auto;
        }

        input[type="range"] {
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ ä»»å‹™ç®¡ç†ç³»çµ±</h1>
            <div class="score-display">
                ç¸½ç©åˆ†: <span id="totalScore">0</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('create')">æ–°å¢ä»»å‹™</button>
            <button class="nav-tab" onclick="switchTab('pending')">å‰©é¤˜ä»»å‹™</button>
            <button class="nav-tab" onclick="switchTab('overdue')">é²äº¤ä»»å‹™</button>
            <button class="nav-tab" onclick="switchTab('completed')">å®Œæˆä»»å‹™</button>
            <button class="nav-tab" onclick="switchTab('points')">ç©åˆ†å•†åº—</button>
            <button class="nav-tab" onclick="switchTab('calendar')">æ—¥æ­·æ’ç¨‹</button>
        </div>

        <div class="content">
            <!-- æ–°å¢ä»»å‹™ä»‹é¢ -->
            <div id="create-tab" class="tab-content active">
                <div class="task-form">
                    <h2 style="margin-bottom: 20px;">âœ¨ æ–°å¢ä»»å‹™</h2>
                    <div class="form-group">
                        <label>ä»»å‹™åç¨±</label>
                        <input type="text" id="taskName" placeholder="è¼¸å…¥ä»»å‹™åç¨±">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>åŸ·è¡ŒæœŸé–“ (æ ¼å¼: yyyymmdd-yyyymmdd æˆ– yyyymmdd)</label>
                            <div class="input-with-calendar">
                                <input type="text" id="taskPeriod" placeholder="ä¾‹å¦‚: 20250201-20250228">
                                <div class="date-picker-icon" title="é¸æ“‡é–‹å§‹æ—¥æœŸ (aæ™‚é–“)">
                                    <div class="calendar-icon">ğŸ“…<sub style="font-size: 10px;">a</sub></div>
                                    <input type="date" id="taskPeriodStart" onchange="updatePeriodFromCalendar()">
                                </div>
                                <div class="date-picker-icon" title="é¸æ“‡çµæŸæ—¥æœŸ (bæ™‚é–“)">
                                    <div class="calendar-icon">ğŸ“…<sub style="font-size: 10px;">b</sub></div>
                                    <input type="date" id="taskPeriodEnd" onchange="updatePeriodFromCalendar()">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>æˆªæ­¢æ—¥æœŸ (æ ¼å¼: yyyymmdd)</label>
                            <div class="input-with-calendar">
                                <input type="text" id="taskDeadline" placeholder="ä¾‹å¦‚: 20250228">
                                <div class="date-picker-icon" title="é¸æ“‡æ—¥æœŸ">
                                    <div class="calendar-icon">ğŸ“…</div>
                                    <input type="date" id="taskDeadlineCalendar" onchange="updateDeadlineFromCalendar()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ä»»å‹™é¡å‹</label>
                            <select id="taskType">
                                <option value="personal">å€‹äººä»»å‹™</option>
                                <option value="weekly">å‘¨å¸¸ä»»å‹™</option>
                                <option value="learning">å­¸ç¿’ä»»å‹™</option>
                                <option value="other">å…¶ä»–ä»»å‹™</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é‡è¦åº¦</label>
                            <select id="taskImportance">
                                <option value="1">ä½ (1åˆ†)</option>
                                <option value="2">ä¸­ (2åˆ†)</option>
                                <option value="3">é«˜ (3åˆ†)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>é›£åº¦</label>
                        <select id="taskDifficulty">
                            <option value="1">ç°¡å–® (1åˆ†)</option>
                            <option value="2">ä¸­ç­‰ (2åˆ†)</option>
                            <option value="3">å›°é›£ (3åˆ†)</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="addTask()">æ–°å¢ä»»å‹™</button>
                </div>
            </div>

            <!-- å‰©é¤˜ä»»å‹™ä»‹é¢ -->
            <div id="pending-tab" class="tab-content">
                <h2 style="margin-bottom: 20px;">ğŸ“ å‰©é¤˜ä»»å‹™</h2>
                <div id="pendingTaskList" class="task-list"></div>
            </div>

            <!-- é²äº¤ä»»å‹™ä»‹é¢ -->
            <div id="overdue-tab" class="tab-content">
                <h2 style="margin-bottom: 20px;">âš ï¸ é²äº¤ä»»å‹™</h2>
                <div id="overdueTaskList" class="task-list"></div>
            </div>

            <!-- å®Œæˆä»»å‹™ä»‹é¢ -->
            <div id="completed-tab" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>âœ… å®Œæˆä»»å‹™</h2>
                    <div class="completed-count">
                        å·²å®Œæˆ: <span id="completedCount">0</span> å€‹ä»»å‹™
                    </div>
                </div>
                <div id="completedTaskList" class="task-list"></div>
            </div>

            <!-- ç©åˆ†å•†åº—ä»‹é¢ -->
            <div id="points-tab" class="tab-content">
                <h2 style="margin-bottom: 20px;">ğŸ’° ç©åˆ†å•†åº—</h2>
                <div class="points-form">
                    <h3>æ–°å¢ä½¿ç”¨ç©åˆ†é …ç›®</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>é …ç›®åç¨±</label>
                            <input type="text" id="rewardName" placeholder="ä¾‹å¦‚: çœ‹ä¸€éƒ¨é›»å½±">
                        </div>
                        <div class="form-group">
                            <label>æ‰€éœ€ç©åˆ†</label>
                            <input type="number" id="rewardPoints" placeholder="ä¾‹å¦‚: 10" min="1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addReward()">æ–°å¢é …ç›®</button>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">å¯å…Œæ›é …ç›®</h3>
                    <div id="rewardsList" class="task-list"></div>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">å…Œæ›è¨˜éŒ„</h3>
                    <div id="redeemHistory" class="task-list"></div>
                </div>
            </div>

            <!-- æ—¥æ­·ä»‹é¢ -->
            <div id="calendar-tab" class="tab-content">
                <h2 style="margin-bottom: 20px;">ğŸ“… æ—¥æ­·æ’ç¨‹</h2>
                <div id="calendarContainer" class="calendar-section"></div>
            </div>
        </div>
    </div>

    <script>
        let tasks = [];
        let totalScore = 0;
        let draggedTask = null;
        let rewards = [];
        let redeemHistory = [];

        // åˆå§‹åŒ–
        function init() {
            const savedTasks = localStorage.getItem('tasks');
            const savedScore = localStorage.getItem('totalScore');
            const savedRewards = localStorage.getItem('rewards');
            const savedHistory = localStorage.getItem('redeemHistory');
            
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
            if (savedScore) {
                totalScore = parseInt(savedScore);
            }
            if (savedRewards) {
                rewards = JSON.parse(savedRewards);
            }
            if (savedHistory) {
                redeemHistory = JSON.parse(savedHistory);
            }
            
            updateScore();
            renderCalendar();
            renderTasks();
            renderRewards();
        }

        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'pending' || tabName === 'overdue' || tabName === 'completed') {
                renderTasks();
            } else if (tabName === 'points') {
                renderRewards();
            }
        }

        // æ›´æ–°é€²åº¦å€¼é¡¯ç¤º
        function updateProgressValue() {
            const value = document.getElementById('taskProgress').value;
            document.getElementById('progressValue').textContent = value + '%';
        }

        // æ–°å¢ä»»å‹™
        function addTask() {
            const name = document.getElementById('taskName').value;
            const deadline = document.getElementById('taskDeadline').value;
            const period = document.getElementById('taskPeriod').value;
            const type = document.getElementById('taskType').value;
            const importance = parseInt(document.getElementById('taskImportance').value);
            const difficulty = parseInt(document.getElementById('taskDifficulty').value);
            const progress = 0;

            if (!name || !deadline) {
                alert('è«‹å¡«å¯«ä»»å‹™åç¨±å’Œæˆªæ­¢æ—¥æœŸï¼');
                return;
            }

            // é©—è­‰æ—¥æœŸæ ¼å¼
            if (!validateDateFormat(deadline)) {
                alert('æˆªæ­¢æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼è«‹ä½¿ç”¨ YYYYMMDD æ ¼å¼ï¼Œä¾‹å¦‚ï¼š20250228');
                return;
            }

            if (period && !validatePeriodFormat(period)) {
                alert('åŸ·è¡ŒæœŸé–“æ ¼å¼éŒ¯èª¤ï¼è«‹ä½¿ç”¨ yyyymmdd-yyyymmdd æˆ– yyyymmdd æ ¼å¼ï¼Œä¾‹å¦‚ï¼š20250201-20250228 æˆ– 20250201');
                return;
            }

            const task = {
                id: Date.now(),
                name,
                deadline: formatToStandardDate(deadline),
                period: period ? period : '',
                type,
                importance,
                difficulty,
                progress,
                points: importance * difficulty,
                completed: false,
                completedDate: null,
                note: '',
                subtasks: [],
                scheduledDate: null
            };

            tasks.push(task);
            saveTasks();
            renderTasks();
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('taskName').value = '';
            document.getElementById('taskDeadline').value = '';
            document.getElementById('taskPeriod').value = '';
            document.getElementById('taskPeriodStart').value = '';
            document.getElementById('taskPeriodEnd').value = '';
            document.getElementById('taskDeadlineCalendar').value = '';

            alert('ä»»å‹™æ–°å¢æˆåŠŸï¼');
        }

        // é©—è­‰æ—¥æœŸæ ¼å¼ YYYYMMDD
        function validateDateFormat(dateStr) {
            return /^\d{8}$/.test(dateStr);
        }

        // é©—è­‰æœŸé–“æ ¼å¼ YYYYMMDD-YYYYMMDD æˆ– YYYYMMDD
        function validatePeriodFormat(periodStr) {
            return /^\d{8}(-\d{8})?$/.test(periodStr);
        }

        // è½‰æ›æ ¼å¼ YYYYMMDD åˆ° YYYY-MM-DD
        function formatToStandardDate(dateStr) {
            return dateStr.slice(0, 4) + '-' + dateStr.slice(4, 6) + '-' + dateStr.slice(6, 8);
        }

        // è½‰æ›æ ¼å¼ YYYY-MM-DD åˆ° YYYYMMDD
        function formatToCompactDate(dateStr) {
            return dateStr.replace(/-/g, '');
        }

        // å¾æ—¥æ­·æ›´æ–°åŸ·è¡ŒæœŸé–“
        function updatePeriodFromCalendar() {
            const start = document.getElementById('taskPeriodStart').value;
            const end = document.getElementById('taskPeriodEnd').value;
            
            if (start && end) {
                const startCompact = formatToCompactDate(start);
                const endCompact = formatToCompactDate(end);
                document.getElementById('taskPeriod').value = `${startCompact}-${endCompact}`;
            } else if (start) {
                const startCompact = formatToCompactDate(start);
                document.getElementById('taskPeriod').value = startCompact;
            }
        }

        // å¾æ—¥æ­·æ›´æ–°æˆªæ­¢æ—¥æœŸ
        function updateDeadlineFromCalendar() {
            const deadline = document.getElementById('taskDeadlineCalendar').value;
            
            if (deadline) {
                const deadlineCompact = formatToCompactDate(deadline);
                document.getElementById('taskDeadline').value = deadlineCompact;
            }
        }

        // æ¸²æŸ“ä»»å‹™åˆ—è¡¨
        function renderTasks() {
            const pendingList = document.getElementById('pendingTaskList');
            const overdueList = document.getElementById('overdueTaskList');
            const completedList = document.getElementById('completedTaskList');
            
            pendingList.innerHTML = '';
            overdueList.innerHTML = '';
            completedList.innerHTML = '';

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // åˆ†é¡ä»»å‹™ä¸¦æ’åº
            const pendingTasks = [];
            const overdueTasks = [];
            const completedTasks = [];

            tasks.forEach(task => {
                if (task.completed) {
                    completedTasks.push(task);
                } else {
                    const taskDeadline = new Date(task.deadline);
                    taskDeadline.setHours(0, 0, 0, 0);
                    
                    // è¨ˆç®—å¤©æ•¸å·®ç•°
                    const diffTime = taskDeadline - today;
                    const daysLeft = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    // daysLeft < 0 æ‰ç®—é²äº¤ï¼ŒdaysLeft >= 0 éƒ½åœ¨å‰©é¤˜ä»»å‹™
                    if (daysLeft < 0) {
                        overdueTasks.push({ task, daysLeft });
                    } else {
                        pendingTasks.push({ task, daysLeft });
                    }
                }
            });

            // å‰©é¤˜ä»»å‹™æŒ‰å‰©é¤˜æ™‚é–“å¾å°‘åˆ°å¤šæ’åº
            pendingTasks.sort((a, b) => a.daysLeft - b.daysLeft);
            overdueTasks.sort((a, b) => a.daysLeft - b.daysLeft);

            // æ¸²æŸ“å‰©é¤˜ä»»å‹™
            pendingTasks.forEach(({ task, daysLeft }) => {
                const taskCard = createTaskCard(task, false, daysLeft);
                pendingList.appendChild(taskCard);
            });

            // æ¸²æŸ“é²äº¤ä»»å‹™
            overdueTasks.forEach(({ task, daysLeft }) => {
                const taskCard = createTaskCard(task, true, daysLeft);
                overdueList.appendChild(taskCard);
            });

            // æ¸²æŸ“å®Œæˆä»»å‹™
            completedTasks.forEach(task => {
                const completedCard = createCompletedTaskCard(task);
                completedList.appendChild(completedCard);
            });

            // æ›´æ–°å®Œæˆä»»å‹™æ•¸é‡
            const completedCount = tasks.filter(t => t.completed).length;
            document.getElementById('completedCount').textContent = completedCount;
        }

        // å‰µå»ºä»»å‹™å¡ç‰‡
        function createTaskCard(task, isOverdue, daysLeft) {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.draggable = true;
            card.dataset.taskId = task.id;

            // é˜²æ­¢å¡ç‰‡å…§çš„å…ƒç´ è¢«æ‹–æ›³
            card.addEventListener('mousedown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON' || e.target.tagName === 'TEXTAREA') {
                    card.draggable = false;
                } else {
                    card.draggable = true;
                }
            });

            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);

            const typeClass = `type-${task.type}`;
            const typeNames = {
                personal: 'å€‹äººä»»å‹™',
                weekly: 'å‘¨å¸¸ä»»å‹™',
                learning: 'å­¸ç¿’ä»»å‹™',
                other: 'å…¶ä»–ä»»å‹™'
            };

            const deadlineClass = isOverdue ? 'deadline-overdue' : 'deadline-ok';
            const deadlineText = isOverdue ? `é²äº¤ ${Math.abs(daysLeft)} å¤©` : (daysLeft === 0 ? 'ä»Šå¤©æˆªæ­¢' : `å‰©é¤˜ ${daysLeft} å¤©`);

            card.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.name}</div>
                    <div class="task-type ${typeClass}">${typeNames[task.type]}</div>
                </div>
                <div class="task-info">
                    <div>ğŸ“… æˆªæ­¢: ${task.deadline}</div>
                    <div class="task-deadline ${deadlineClass}">â° ${deadlineText}</div>
                    ${task.period ? `<div>â³ åŸ·è¡ŒæœŸé–“: ${task.period}</div>` : '<div></div>'}
                    <div>ğŸ’ ç©åˆ†: ${task.points}</div>
                    <div>â­ é›£åº¦: ${task.difficulty} | é‡è¦åº¦: ${task.importance}</div>
                </div>
                ${createSubtasksHTML(task)}
                <div class="form-group">
                    <label>é€²åº¦ (%)</label>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="${task.progress}" 
                            oninput="updateTaskProgressSlider(${task.id}, this.value); this.nextElementSibling.textContent = this.value + '%'">
                        <span class="slider-value">${task.progress}%</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${task.progress}%">
                        ${task.progress}%
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn btn-small btn-primary" onclick="completeTask(${task.id})">å®Œæˆ</button>
                    <button class="btn btn-small btn-danger" onclick="deleteTask(${task.id})">åˆªé™¤</button>
                </div>
            `;

            return card;
        }

        // å‰µå»ºå­ä»»å‹™HTML
        function createSubtasksHTML(task) {
            if (!task.subtasks) task.subtasks = [];
            
            let subtasksHTML = '<div class="subtasks-container">';
            subtasksHTML += '<div style="font-weight: bold; margin-bottom: 10px;">ğŸ“‹ å­ä»»å‹™æ¸…å–®ï¼š</div>';
            
            task.subtasks.forEach((subtask, index) => {
                subtasksHTML += `
                    <div class="subtask-item">
                        <input type="checkbox" class="subtask-checkbox" 
                            ${subtask.completed ? 'checked' : ''} 
                            onchange="toggleSubtask(${task.id}, ${index})">
                        <span class="subtask-text ${subtask.completed ? 'completed' : ''}">${subtask.text}</span>
                        <button class="subtask-delete" onclick="deleteSubtask(${task.id}, ${index})">åˆªé™¤</button>
                    </div>
                `;
            });
            
            subtasksHTML += `
                <div class="subtask-input-group">
                    <input type="text" class="subtask-input" id="subtask-input-${task.id}" placeholder="æ–°å¢å­ä»»å‹™...">
                    <button class="btn-add-subtask" onclick="addSubtask(${task.id})">æ–°å¢</button>
                </div>
            </div>`;
            
            return subtasksHTML;
        }

        // å‰µå»ºå·²å®Œæˆä»»å‹™å¡ç‰‡
        function createCompletedTaskCard(task) {
            const card = document.createElement('div');
            card.className = 'task-card completed-card';

            const typeClass = `type-${task.type}`;
            const typeNames = {
                personal: 'å€‹äººä»»å‹™',
                weekly: 'å‘¨å¸¸ä»»å‹™',
                learning: 'å­¸ç¿’ä»»å‹™',
                other: 'å…¶ä»–ä»»å‹™'
            };

            card.innerHTML = `
                <div class="task-header">
                    <div class="task-title">âœ“ ${task.name}</div>
                    <div class="task-type ${typeClass}">${typeNames[task.type]}</div>
                </div>
                <div class="task-info">
                    <div>ğŸ“… æˆªæ­¢æ—¥: ${task.deadline}</div>
                    <div class="completed-date">âœ… å®Œæˆæ—¥: ${task.completedDate}</div>
                    <div>ğŸ’ ç²å¾—ç©åˆ†: ${task.points}</div>
                    <div>â­ é›£åº¦: ${task.difficulty} | é‡è¦åº¦: ${task.importance}</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%">
                        å®Œæˆ
                    </div>
                </div>
                <div class="note-section">
                    <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“ ä»»å‹™è¨»è§£ï¼š</div>
                    ${task.note ? `<div class="note-content">${task.note}</div>` : ''}
                    <textarea class="note-input" placeholder="æ–°å¢æˆ–ç·¨è¼¯è¨»è§£..." 
                        onchange="updateTaskNote(${task.id}, this.value)">${task.note || ''}</textarea>
                </div>
                <div class="task-actions">
                    <button class="btn btn-small btn-delete-small" onclick="deleteCompletedTask(${task.id})">åˆªé™¤</button>
                </div>
            `;

            return card;
        }

        // æ›´æ–°ä»»å‹™é€²åº¦ï¼ˆæ»‘æ¡¿ï¼‰
        function updateTaskProgressSlider(taskId, progress) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            task.progress = parseInt(progress);
            saveTasks();
        }

        // æ–°å¢å­ä»»å‹™
        function addSubtask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const input = document.getElementById(`subtask-input-${taskId}`);
            const text = input.value.trim();
            
            if (!text) {
                alert('è«‹è¼¸å…¥å­ä»»å‹™å…§å®¹ï¼');
                return;
            }

            if (!task.subtasks) task.subtasks = [];
            task.subtasks.push({ text, completed: false });
            
            saveTasks();
            renderTasks();
        }

        // åˆ‡æ›å­ä»»å‹™ç‹€æ…‹
        function toggleSubtask(taskId, subtaskIndex) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.subtasks[subtaskIndex]) return;

            task.subtasks[subtaskIndex].completed = !task.subtasks[subtaskIndex].completed;
            saveTasks();
            renderTasks();
        }

        // åˆªé™¤å­ä»»å‹™
        function deleteSubtask(taskId, subtaskIndex) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å­ä»»å‹™å—ï¼Ÿ')) return;

            task.subtasks.splice(subtaskIndex, 1);
            saveTasks();
            renderTasks();
        }

        // å®Œæˆä»»å‹™
        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (task.progress < 100) {
                if (!confirm('é€²åº¦æœªé” 100%ï¼Œç¢ºå®šè¦å®Œæˆå—ï¼Ÿ')) {
                    return;
                }
            }

            // æª¢æŸ¥æ˜¯å¦é²äº¤
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const taskDeadline = new Date(task.deadline);
            taskDeadline.setHours(0, 0, 0, 0);
            const diffTime = taskDeadline - today;
            const daysLeft = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // é²äº¤ä»»å‹™ä»å¯å®Œæˆä¸¦ç²å¾—ç©åˆ†
            task.completed = true;
            task.progress = 100;
            task.completedDate = new Date().toISOString().split('T')[0];
            totalScore += task.points;
            
            saveTasks();
            updateScore();
            renderTasks();
            
            if (daysLeft < 0) {
                alert(`ä»»å‹™å®Œæˆï¼é›–ç„¶é²äº¤äº† ${Math.abs(daysLeft)} å¤©ï¼Œä½†ä»ç²å¾— ${task.points} ç©åˆ†ï¼`);
            } else {
                alert(`ä»»å‹™å®Œæˆï¼ç²å¾— ${task.points} ç©åˆ†ï¼`);
            }
        }

        // æ›´æ–°ä»»å‹™è¨»è§£
        function updateTaskNote(taskId, note) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            task.note = note;
            saveTasks();
        }

        // åˆªé™¤å·²å®Œæˆä»»å‹™è¨˜éŒ„
        function deleteCompletedTask(taskId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å®Œæˆè¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤è¨˜éŒ„ä¸¦æ‰£é™¤å·²ç²å¾—çš„ç©åˆ†ã€‚')) return;

            const task = tasks.find(t => t.id === taskId);
            if (task && task.completed) {
                totalScore -= task.points;
                updateScore();
            }

            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            
            alert('å®Œæˆè¨˜éŒ„å·²åˆªé™¤ï¼Œç©åˆ†å·²æ‰£é™¤ï¼');
        }

        // åˆªé™¤ä»»å‹™
        function deleteTask(taskId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ä»»å‹™å—ï¼Ÿæ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤æ‰€æœ‰ç›¸é—œè³‡æ–™ã€‚')) return;

            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            renderCalendar();
            
            alert('ä»»å‹™å·²åˆªé™¤ï¼');
        }

        // æ›´æ–°ç©åˆ†é¡¯ç¤º
        function updateScore() {
            document.getElementById('totalScore').textContent = totalScore;
            localStorage.setItem('totalScore', totalScore);
        }

        // ä¿å­˜ä»»å‹™
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        // æ‹–æ›³è™•ç†
        function handleDragStart(e) {
            draggedTask = parseInt(e.target.dataset.taskId);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // æ¸²æŸ“æ—¥æ­·
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';

            const currentYear = new Date().getFullYear();
            const months = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];

            for (let month = 0; month < 12; month++) {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'calendar-month';
                
                const firstDay = new Date(currentYear, month, 1);
                const lastDay = new Date(currentYear, month + 1, 0);
                const startingDayOfWeek = firstDay.getDay();
                const daysInMonth = lastDay.getDate();

                monthDiv.innerHTML = `
                    <div class="month-header">
                        <span>${currentYear} å¹´ ${months[month]}</span>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-day-header">æ—¥</div>
                        <div class="calendar-day-header">ä¸€</div>
                        <div class="calendar-day-header">äºŒ</div>
                        <div class="calendar-day-header">ä¸‰</div>
                        <div class="calendar-day-header">å››</div>
                        <div class="calendar-day-header">äº”</div>
                        <div class="calendar-day-header">å…­</div>
                    </div>
                `;

                const grid = monthDiv.querySelector('.calendar-grid');

                // å¡«å……ç©ºç™½æ—¥æœŸ
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    grid.appendChild(emptyDay);
                }

                // å¡«å……æœˆä»½æ—¥æœŸ
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day';
                    dayDiv.dataset.date = `${currentYear}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    
                    dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                    
                    // æ·»åŠ è©²æ—¥æœŸçš„ä»»å‹™
                    const dateTasks = tasks.filter(t => t.scheduledDate === dayDiv.dataset.date && !t.completed);
                    dateTasks.forEach(task => {
                        const taskEl = document.createElement('div');
                        taskEl.className = 'calendar-task';
                        taskEl.textContent = task.name;
                        dayDiv.appendChild(taskEl);
                    });

                    // æ·»åŠ æˆªæ­¢æ—¥æœŸæ¨™è¨˜
                    const deadlineTasks = tasks.filter(t => t.deadline === dayDiv.dataset.date && !t.completed);
                    deadlineTasks.forEach(task => {
                        const deadlineEl = document.createElement('div');
                        deadlineEl.className = 'calendar-deadline';
                        deadlineEl.textContent = 'ğŸš¨ ' + task.name;
                        dayDiv.appendChild(deadlineEl);
                    });

                    // æ·»åŠ åŸ·è¡ŒæœŸé–“æ¨™è¨˜
                    tasks.forEach(task => {
                        if (task.period && !task.completed) {
                            let start, end;
                            
                            // è™•ç†å–®æ—¥æˆ–æœŸé–“æ ¼å¼
                            if (task.period.includes('-')) {
                                const [startDate, endDate] = task.period.split('-');
                                start = formatToStandardDate(startDate);
                                end = formatToStandardDate(endDate);
                            } else {
                                // å–®æ—¥æ ¼å¼
                                start = formatToStandardDate(task.period);
                                end = start;
                            }
                            
                            if (dayDiv.dataset.date >= start && dayDiv.dataset.date <= end) {
                                const periodEl = document.createElement('div');
                                periodEl.className = 'calendar-period';
                                periodEl.textContent = 'â–¶ ' + task.name;
                                dayDiv.appendChild(periodEl);
                            }
                        }
                    });

                    dayDiv.addEventListener('dragover', handleDragOver);
                    dayDiv.addEventListener('drop', handleDrop);
                    dayDiv.addEventListener('dragleave', handleDragLeave);

                    grid.appendChild(dayDiv);
                }

                container.appendChild(monthDiv);
            }
        }

        // æ–°å¢çå‹µé …ç›®
        function addReward() {
            const name = document.getElementById('rewardName').value;
            const points = parseInt(document.getElementById('rewardPoints').value);

            if (!name || !points || points <= 0) {
                alert('è«‹å¡«å¯«é …ç›®åç¨±å’Œæ‰€éœ€ç©åˆ†ï¼');
                return;
            }

            const reward = {
                id: Date.now(),
                name,
                points
            };

            rewards.push(reward);
            saveRewards();
            renderRewards();

            // æ¸…ç©ºè¡¨å–®
            document.getElementById('rewardName').value = '';
            document.getElementById('rewardPoints').value = '';

            alert('é …ç›®æ–°å¢æˆåŠŸï¼');
        }

        // å…Œæ›çå‹µ
        function redeemReward(rewardId) {
            const reward = rewards.find(r => r.id === rewardId);
            if (!reward) return;

            if (totalScore < reward.points) {
                alert(`ç©åˆ†ä¸è¶³ï¼é‚„éœ€è¦ ${reward.points - totalScore} ç©åˆ†`);
                return;
            }

            if (!confirm(`ç¢ºå®šè¦ç”¨ ${reward.points} ç©åˆ†å…Œæ›ã€Œ${reward.name}ã€å—ï¼Ÿ`)) {
                return;
            }

            totalScore -= reward.points;
            updateScore();

            // è¨˜éŒ„å…Œæ›æ­·å²
            const historyItem = {
                id: Date.now(),
                rewardName: reward.name,
                points: reward.points,
                date: new Date().toISOString().split('T')[0]
            };

            redeemHistory.unshift(historyItem);
            saveHistory();
            renderRewards();

            alert(`å…Œæ›æˆåŠŸï¼å·²æ‰£é™¤ ${reward.points} ç©åˆ†`);
        }

        // åˆªé™¤çå‹µé …ç›®
        function deleteReward(rewardId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤çå‹µé …ç›®å—ï¼Ÿ')) return;

            rewards = rewards.filter(r => r.id !== rewardId);
            saveRewards();
            renderRewards();
            
            alert('çå‹µé …ç›®å·²åˆªé™¤ï¼');
        }

        // åˆªé™¤å…Œæ›è¨˜éŒ„
        function deleteHistory(historyId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å…Œæ›è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œä¸æœƒè¿”é‚„ç©åˆ†ã€‚')) return;

            redeemHistory = redeemHistory.filter(h => h.id !== historyId);
            saveHistory();
            renderRewards();
            
            alert('å…Œæ›è¨˜éŒ„å·²åˆªé™¤ï¼');
        }

        // æ¸²æŸ“çå‹µå’Œæ­·å²
        function renderRewards() {
            const rewardsList = document.getElementById('rewardsList');
            const historyList = document.getElementById('redeemHistory');

            rewardsList.innerHTML = '';
            historyList.innerHTML = '';

            // æ¸²æŸ“å¯å…Œæ›é …ç›®
            if (rewards.length === 0) {
                rewardsList.innerHTML = '<p style="text-align: center; color: #999;">å°šç„¡å¯å…Œæ›é …ç›®</p>';
            } else {
                rewards.forEach(reward => {
                    const rewardCard = document.createElement('div');
                    rewardCard.className = 'reward-card';
                    
                    const canRedeem = totalScore >= reward.points;
                    
                    rewardCard.innerHTML = `
                        <div class="reward-info">
                            <div class="reward-name">${reward.name}</div>
                            <div class="reward-points">ğŸ’ éœ€è¦ ${reward.points} ç©åˆ†</div>
                        </div>
                        <div class="reward-actions">
                            <button class="btn btn-small btn-primary" 
                                ${!canRedeem ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}
                                onclick="redeemReward(${reward.id})">
                                ${canRedeem ? 'å…Œæ›' : 'ç©åˆ†ä¸è¶³'}
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteReward(${reward.id}); event.stopPropagation();">åˆªé™¤</button>
                        </div>
                    `;
                    
                    rewardsList.appendChild(rewardCard);
                });
            }

            // æ¸²æŸ“å…Œæ›è¨˜éŒ„
            if (redeemHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999;">å°šç„¡å…Œæ›è¨˜éŒ„</p>';
            } else {
                redeemHistory.forEach(item => {
                    const historyCard = document.createElement('div');
                    historyCard.className = 'history-card';
                    
                    historyCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; margin-bottom: 5px;">${item.rewardName}</div>
                                <div style="color: #f44336; font-weight: bold;">-${item.points} ç©åˆ†</div>
                                <div class="history-date">å…Œæ›æ—¥æœŸ: ${item.date}</div>
                            </div>
                            <button class="btn btn-small btn-delete-small" onclick="deleteHistory(${item.id}); event.stopPropagation();">åˆªé™¤</button>
                        </div>
                    `;
                    
                    historyList.appendChild(historyCard);
                });
            }
        }

        // ä¿å­˜çå‹µ
        function saveRewards() {
            localStorage.setItem('rewards', JSON.stringify(rewards));
        }

        // ä¿å­˜å…Œæ›è¨˜éŒ„
        function saveHistory() {
            localStorage.setItem('redeemHistory', JSON.stringify(redeemHistory));
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const date = e.currentTarget.dataset.date;
            if (!date || !draggedTask) return;

            const task = tasks.find(t => t.id === draggedTask);
            if (task) {
                task.scheduledDate = date;
                saveTasks();
                renderCalendar();
                alert(`ä»»å‹™å·²æ’ç¨‹åˆ° ${date}`);
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>